---
title: "Raffle Simulation"
author: "Justin Meyer"
date: "December 11, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Description of the analysis

At the recent Tech Gala in Madison, Wisconsin there was a raffle for a number
of items. We bought 10 tickets and entered to win nine of the items (one ticket 
apparently went missing). We won five of the nine items that we tried to win.

This seemed like a very unlikely outcome so I got the data from the raffle 
organizer. Here are the items that we entered, the number of tickets we entered,
the number of total tickets that were entered, and whether or not we won:

Pinecone 1/8 (won)
Card 1/2 (didn't)
Candle 1/9 (didn't)
Cutting boards [5 of these] 1/24 (didn't)
Studio class 1/21 (didn't)
Gift card 1/7 (won)
Hammer [2 of these] 1/11 (won)
Stand [4 of these] 1/37 (won)
Cards 1/1 (won) # What to do with this? 1/1 makes the odds infinite which makes the overall odds infinite.

The following code simulates the raffle one million times.

# Simulate the raffle

```{r, echo = TRUE}

# Create source data
pinecone <- c(1, rep(0, 7))
card <- c(1, 0)
candle <- c(1, rep(0, 8))
board <- c(1, rep(0, 23))
class <- c(1, rep(0, 20))
gift_card <- c(1, rep(0, 6))
hammer <- c(1, rep(0, 10))
stand <- c(1, rep(0, 36))
cards <- c(1)

# Create a vector to store the number of items won
items_won_vector <- vector("numeric")

# Simulation loop
for(i in 1:1000000){
        
        # Determine if each item was won
        pinecone_won <- sample(pinecone, 1)
        card_won <- sample(card, 1)
        candle_won <- sample(candle, 1)
        board_won <- sum(sample(board, 5, replace = FALSE))
        class_won <- sample(class, 1)
        gift_card_won <- sample(gift_card, 1)
        hammer_won <- sum(sample(hammer, 2, replace = FALSE))
        stand_won <- sum(sample(stand, 4, replace = FALSE))
        cards_won <- sample(cards, 1)

        # Calculate total number of items won
        items_won <- sum(pinecone_won, card_won, 
                         candle_won, board_won, 
                         class_won, gift_card_won, 
                         hammer_won, stand_won, 
                         cards_won)
        
        # Report progress of simulation
        print(paste0("test: ", i))
        print(items_won)
        
        # Add number of items won to vector
        items_won_vector[i] <- items_won
        
        # Clean up
        rm(items_won,
                pinecone_won, card_won, 
                candle_won, board_won, 
                class_won, gift_card_won, 
                hammer_won, stand_won, 
                cards_won)
        
        }

```

### Summary statistics

```{r, echo = TRUE}

# Summary stats
summary(items_won_vector)

```

### Count of items won

```{r, echo = TRUE}

# Count of number of items won
table(items_won_vector)

```

# Histogram of the count of items won

```{r echo = TRUE}

hist(items_won_vector)

```

### Percent of items won

```{r, echo = TRUE}

# Percent of number of items won
temp <- table(items_won_vector)
prop.table(temp)


```

# Deterministic method

While I created the above simulation my friend Carl approached the problem 
from a different direction. He calculated the odds of the outcome and 
came up with a very similar result:

```{r, echo = TRUE}

winProbs <- c(1/8,
              1/2,
              1/9,
              sum(1/24,1/23,1/22,1/21,1/20),
              1/21,
              1/7,
              sum(1/11, 1/10),
              sum(1/37, 1/36, 1/35, 1/34),
              1)

#All combos of 5 from 9
allPossible = combn(9,5)

#Find joint probability of each outcome of 5 ... don't forget probabilities of losing the 4 that are not won.
probs <- sapply(1:dim(allPossible)[2], function(x) prod(winProbs[allPossible[,x]],
                                                        1-winProbs[-allPossible[,x]]))

```

### Probability of winning any five items:

```{r, echo = TRUE}

sum(probs)

```
